<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Salidas Furgo</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0}
    body{padding:24px;background:#f5f7fb;color:#0b1220}
    .card{max-width:720px;margin:0 auto;background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(12,20,40,0.06);padding:20px}
    h1{font-size:20px;margin:0 0 12px}
    p.lead{margin:0 0 18px;color:#475569}
    ul.list{list-style:none;padding:0;margin:0;display:grid;gap:8px}
    li.item{display:flex;align-items:center;gap:12px;padding:8px 10px;border-radius:8px;border:1px solid transparent;cursor:pointer;user-select:none;max-width:520px;margin:0 auto}
    li.item:hover{transform:translateY(-1px);box-shadow:0 6px 12px rgba(12,20,40,0.04)}
    li.item.selected{background:linear-gradient(90deg,#eef2ff,#f8fafc);border-color:#c7d2fe}
    .checkbox{width:18px;height:18px;border-radius:4px;border:1px solid #cbd5e1;display:inline-grid;place-items:center}
    .checkbox.checked{background:#6366f1;border-color:#6366f1;color:white}
    .label{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .actions{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;justify-content:center}
    button{padding:8px 12px;border-radius:8px;border:0;background:#0ea5a4;color:white;cursor:pointer}
    button.secondary{background:#64748b}
    .add-container{margin-top:16px;display:flex;gap:8px;justify-content:center}
    input#newItem{flex:1;padding:8px;border:1px solid #cbd5e1;border-radius:8px;max-width:420px}
    pre#out{background:#0b1220;color:#f8fafc;padding:12px;border-radius:8px;margin-top:12px;overflow:auto;max-width:720px;margin-left:auto;margin-right:auto}
    .float-info{position:fixed;top:16px;right:16px;background:#10b981;color:white;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(16,185,129,0.18);max-width:260px;z-index:999}
    .float-info h4{margin:0 0 6px;font-size:13px}
    .float-info p{margin:0;font-size:13px}
    #missingPanel{max-width:720px;margin:12px auto 0;background:#fff;border-radius:10px;padding:12px;border:1px solid #e6fffa;display:none}
  </style>
</head>
<body>
  <div class="float-info" id="floatInfo" aria-live="polite">
    <h4>Faltan por seleccionar:</h4>
    <div id="floatList">...</div>
  </div>

  <div class="card">
    <h1>Salidas Furgo</h1>
    <p class="lead">Selecciona, agrega y guarda automáticamente. El cartel verde muestra en vivo los faltantes. También puedes abrir el recuadro con el botón "Mostrar faltantes".</p>

    <ul id="myList" class="list" role="listbox" aria-label="Lista B"></ul>

    <div class="add-container">
      <input type="text" id="newItem" placeholder="Nuevo elemento...">
      <button id="addItem">Agregar</button>
    </div>

    <div class="actions">
      <button id="toggleMissing">Mostrar faltantes</button>
      <button id="clearSelections">Borrar selecciones</button>
      <button id="resetList" class="secondary">Resetear lista</button>
      <button id="gotoIndex" class="secondary">Ir al Index</button>
    </div>

    <div id="missingPanel" aria-live="polite"></div>
    <pre id="out" hidden></pre>
  </div>

  <script>
    const STORAGE_KEY = 'listaItems2';
    const list = document.getElementById('myList');
    const out = document.getElementById('out');
    const toggleMissingBtn = document.getElementById('toggleMissing');
    const clearBtn = document.getElementById('clearSelections');
    const resetBtn = document.getElementById('resetList');
    const gotoIndexBtn = document.getElementById('gotoIndex');
    const addBtn = document.getElementById('addItem');
    const newItemInput = document.getElementById('newItem');
    const missingPanel = document.getElementById('missingPanel');
    const floatList = document.getElementById('floatList');

    // Lista de elementos de la página 2
    const defaultItems = [
      { label: 'Cubo África', value: 'cubo_africa', selected: false },
      { label: 'Menaje cocina', value: 'menaje_cocina', selected: false },
      { label: 'Bombona gas', value: 'bombona_gas', selected: false },
      { label: 'Agua', value: 'agua', selected: false },
      { label: 'Colclonetas', value: 'colclonetas', selected: false },
      { label: 'Almohadas', value: 'almohadas', selected: false },
      { label: 'Funda almohadas', value: 'funda_almohadas', selected: false },
      { label: 'Sábana bajera', value: 'sabana_bajera', selected: false },
      { label: 'Sábana superior', value: 'sabana_superior', selected: false },
      { label: 'Manta', value: 'manta', selected: false },
      { label: 'LuluCaravaca', value: 'lulucaravaca', selected: false },
      { label: 'Comida', value: 'comida', selected: false },
      { label: 'Water', value: 'water', selected: false },
      { label: 'Infusiones', value: 'infusiones', selected: false },
      { label: 'Leche', value: 'leche', selected: false },
      { label: 'Cocina', value: 'cocina', selected: false },
      { label: 'Rollo papel', value: 'rollo_papel', selected: false },
      { label: 'Bolsa basura', value: 'bolsa_basura', selected: false },
      { label: 'Toalla', value: 'toalla', selected: false },
      { label: 'Paño cocina', value: 'pano_cocina', selected: false },
      { label: 'Aceite', value: 'aceite', selected: false },
      { label: 'Vinagre', value: 'vinagre', selected: false },
      { label: 'Antimosquitos', value: 'antimosquitos', selected: false },
      { label: 'Sillas', value: 'sillas', selected: false },
      { label: 'Respirador', value: 'respirador', selected: false },
      { label: 'Pastillas medicina', value: 'pastillas_medicina', selected: false }
    ];

    // Inicializa items desde localStorage o por defecto
    let items = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [...defaultItems];

    function renderList() {
      list.innerHTML = '';
      items.forEach(item => {
        const li = document.createElement('li');
        li.className = 'item' + (item.selected ? ' selected' : '');
        li.tabIndex = 0;
        li.dataset.value = item.value;
        li.innerHTML = `<span class="checkbox ${item.selected ? 'checked' : ''}">${item.selected ? '✓' : ''}</span><span class="label">${item.label}</span>`;
        list.appendChild(li);
      });
      updateFloat();
    }

    function updateVisual(li, checked) {
      const box = li.querySelector('.checkbox');
      li.classList.toggle('selected', checked);
      box.classList.toggle('checked', checked);
      box.textContent = checked ? '✓' : '';
    }

    function saveToLocalStorage() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      updateFloat();
    }

    function updateFloat(){
      const missing = items.filter(i=>!i.selected);
      if(missing.length===0){
        floatList.textContent = '— Todos seleccionados —';
      } else {
        floatList.innerHTML = missing.map(m=>`<div>• ${m.label}</div>`).join('');
      }
      if(missingPanel.style.display !== 'none') renderMissingPanel();
    }

    function renderMissingPanel(){
      const missing = items.filter(i=>!i.selected);
      if(missing.length===0){
        missingPanel.innerHTML = '<strong>Todos los elementos están seleccionados ✅</strong>';
      } else {
        missingPanel.innerHTML = '<strong>Faltan por seleccionar:</strong><ul>' + missing.map(m=>`<li>${m.label} (valor: ${m.value})</li>`).join('') + '</ul>';
      }
    }

    // Seleccionar/deseleccionar al hacer click
    list.addEventListener('click', e => {
      const li = e.target.closest('li.item');
      if (!li) return;
      const currently = li.classList.contains('selected');
      updateVisual(li, !currently);
      const item = items.find(i => i.value === li.dataset.value);
      if (item) item.selected = !currently;
      saveToLocalStorage();
    });

    // Mostrar/Ocultar faltantes
    toggleMissingBtn.addEventListener('click', ()=>{
      if(missingPanel.style.display === 'none' || missingPanel.style.display === ''){
        renderMissingPanel();
        missingPanel.style.display = 'block';
      } else {
        missingPanel.style.display = 'none';
      }
    });

    // Borrar todas las selecciones
    clearBtn.addEventListener('click', ()=>{
      items.forEach(i => i.selected = false);
      saveToLocalStorage();
      renderList();
    });

    // Resetear lista
    resetBtn.addEventListener('click', ()=>{
      localStorage.removeItem(STORAGE_KEY);
      items = [...defaultItems];
      renderList();
    });

    // Volver al index
    gotoIndexBtn.addEventListener('click', ()=>{
      window.location.href = 'index.html';
    });

    // Agregar nuevo elemento
    addBtn.addEventListener('click', ()=>{
      const value = newItemInput.value.trim();
      if(!value) return;
      const newItem = { label: value, value: value.toLowerCase().replace(/\s+/g,'_'), selected: false };
      items.push(newItem);
      renderList();
      saveToLocalStorage();
      newItemInput.value = '';
      newItemInput.focus();
    });

    newItemInput.addEventListener('keydown', e=>{ if(e.key === 'Enter') addBtn.click(); });

    renderList();
  </script>
</body>
</html>
